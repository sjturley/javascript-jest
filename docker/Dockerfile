# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# DO NOT EDIT THIS FILE. IT IS AUTO_GENERATED
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
FROM cyberdojofoundation/javascript-node:6d169e9

# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# START of extra commands to fulfil runner's requirements (os=Alpine)
RUN (getent group sandbox) || (addgroup -g 51966 sandbox)
RUN (grep -q sandbox:x:41966 /etc/passwd) || (adduser -D -g "" -h /home/sandbox -G sandbox -s /bin/bash -u 41966 sandbox)
RUN apk add --update coreutils bash tar file
ARG GIT_COMMIT_SHA
ENV SHA=${GIT_COMMIT_SHA}
# END of extra commands to fulfil runner's requirements
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

RUN adduser \
    --disabled-password \
    --gecos "" \
    --ingroup sandbox \
    --home /home/jest \
    jest

COPY package.json /home/jest
RUN chown jest /home/jest/package.json
WORKDIR /home/jest

USER jest
# reinstall npm. See https://github.com/npm/npm/issues/14232
RUN rm -rf /usr/local/lib/node_modules/npm
RUN npm install

USER root
RUN ln -s /home/jest/node_modules /home/sandbox/node_modules


COPY red_amber_green.rb /usr/local/bin
